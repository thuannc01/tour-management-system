<div id="order">
    <!-- step -->
    <div class="row m-0">
        <div class="col-2 p-0 d-flex align-items-center" style="width: 13%;">
            <label class="label-rating pe-3 pt-1">Chọn trạng thái</label>
        </div>
        <div class="col-2" style="width: 9%;">
            <button @click="setStatus('')" type="button" class="btn btn-success">Tất cả</button>
        </div>
        <div class="col-2" style="width: 18%;">
            <button @click="setStatus('Chờ thanh toán')" type="button"
                class="btn btn-primary bg-btn-primary-custom">1.Chờ thanh toán</button>
        </div>
        <div class="col-2" style="width: 16%;">
            <button @click="setStatus('Chờ xác nhận')" type="button" class="btn btn-primary bg-btn-primary-custom">2.Chờ
                xác nhận</button>
        </div>
        <div class="col-2" style="width: 22%;">
            <button @click="setStatus('Chờ đặt phương tiện')" type="button"
                class="btn btn-primary bg-btn-primary-custom">3.Chờ đặt phương tiện</button>
        </div>
        <div class="col-2" style="width: 22%;">
            <button @click="setStatus('Hoàn thành')" type="button" class="btn btn-primary bg-btn-primary-custom">4.Tour
                đã hoàn thành</button>
        </div>
    </div>
    <hr>
    <!-- search -->
    <div class="row mb-2 d-flex justify-content-between">
        <div class="col-8">
            <div class="row d-flex">
                <div class="col-2 d-flex align-items-center">
                    <p class="m-0">Hiển thị</p>
                </div>
                <div class="col-4">
                    <select @change="doSearch" v-model="conditions.page_size" class="form-select"
                        aria-label="Default select example" v-model="">
                        <option value="4" selected>4 dòng dữ liệu</option>
                        <option value="8">8 dòng dữ liệu</option>
                        <option value="16">16 dòng dữ liệu</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="col-4">
            <div class="input-group">
                <input v-model="conditions.title" @change="doSearch" type="text" class="form-control"
                    placeholder="Nhập thông tin tìm kiếm ...">
                <span class="input-group-text">
                    <i class="bi bi-search"></i>
                </span>
            </div>
        </div>
    </div>
    <!-- content -->
    <div class="row">
        <div class="col-12">
            <table style="font-size: 80%;" class="table table-striped mt-1">
                <thead>
                    <tr>
                        <th class="align-middle text-center" style="width: 3%;" scope="col">STT</th>
                        <th class="align-middle" scope="col">Tour đã đặt</th>
                        <th class="align-middle" scope="col" style="width: 9%;">Khách hàng</th>
                        <th class="align-middle" scope="col" style="width: 9%;">Ngày đặt</th>
                        <th class="align-middle" scope="col" style="width: 9%;">Tổng S.Lượng khách</th>
                        <th class="align-middle" scope="col" style="width: 10%;">Đã thanh toán</th>
                        <th class="align-middle" scope="col" style="width: 10%;">Tổng tiền</th>
                        <th class="align-middle" scope="col" style="width: 10%;">Ngày khởi hành</th>
                        <th class="align-middle" scope="col" style="width: 10%;">Trạng thái</th>
                        <th class="align-middle" scope="col" style="width: 10%;">Đặt phương tiện</th>
                        <th class="align-middle text-center" scope="col" style="width: 10%;">Chi tiết & Xác nhận</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="font-weight: 500;" v-for="(order, index) in dataTable" :key="index">
                        <th class="align-middle text-center" scope="row">{{index + 1}}</th>
                        <td class="align-middle">{{order.title}}</td>
                        <td class="align-middle">{{order.full_name}}</td>
                        <td class="align-middle">{{formatDate2(order.reservation_date)}}</td>
                        <td class="align-middle">{{sumQuantity(order.adult_ticket_quantity, order.child_ticket_quantity,
                            order.infant_ticket_quantity)}}</td>
                        <td class="align-middle">{{formatNumber(order.payment_amount)}} đ</td>
                        <td class="align-middle">{{formatNumber(order.total_amount)}} đ</td>
                        <td class="align-middle">{{formatDate(order.departure_time)}}</td>
                        <td class="align-middle">{{order.reservations_status}}</td>
                        <td class="align-middle">
                            <button :class="[order.reservations_status != 'Chờ đặt phương tiện' ? 'btn-disabled' : '']"
                                data-bs-toggle="modal" data-bs-target="#orderTransportationModal" type="button"
                                class="btn btn-success btn-sm bi bi-scooter me-2"
                                @click="showModalTrans(order.departure_time, order.type_transportation_id,(order.adult_ticket_quantity + order.child_ticket_quantity), order.from_province_name, order.to_province_name, order.type_transportation, order.reservation_id)"></button>
                        </td>
                        <td class="align-middle">
                            <button @click="showModalDetailOrder(order.reservation_id)" data-bs-toggle="modal"
                                data-bs-target="#orderDetailModal" type="button"
                                class="btn btn-primary btn-sm bi bi-three-dots me-2"></button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <!-- pagination -->
            <template v-if="true">
                <div :key="reloadKey">
                    <div class="w-100 row m-0 p-0 d-flex justify-content-center">
                        <b-pagination v-model="conditions.page_number" :total-rows="totalRows" align="center"
                            :per-page="4"></b-pagination>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- modal detail -->
    <div class="modal fade" id="orderDetailModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-uppercase" id="exampleModalLabel">Tất cả thông tin chi tiết - Ngày đặt
                        tour này: 11/12/2023</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="customer-info" class="mb-2" v-for="(customer, index) in customerDetail" :key="index">
                        <h6 class="text-uppercase book-trans" style="color: black;">Thông tin <strong>khách
                                hàng</strong> đặt tour - No.{{index + 1}}</h6>
                        <hr class="p-0 m-0 pb-2">
                        <div class="row">
                            <div class="col-6">
                                <thuan-input v-model="customer.full_name" label="Khách hàng" :isRequired="true"
                                    :isDisabled="true" />
                            </div>
                            <div class="col-6">
                                <thuan-input v-model="customer.phone_number" label="Số điện thoại" :isRequired="true"
                                    :isDisabled="true" />
                            </div>
                            <div class="col-6">
                                <thuan-input v-model="customer.email" label="Email" :isRequired="true"
                                    :isDisabled="true" />
                            </div>
                            <div class="col-6">
                                <thuan-input v-model="customer.address" label="Địa chỉ" :isRequired="true"
                                    :isDisabled="true" />
                            </div>
                        </div>
                    </div>
                    <div id="service-tour" class="mb-2">
                        <h6 class="text-uppercase book-trans" style="color: black;">Thông tin về <strong>dịch vụ kèm
                                tour</strong></h6>
                        <hr class="p-0 m-0 pb-2">
                        <div class="row">
                            <div class="col-12 d-flex" v-for="(service, index) in serviceData" :key="index">
                                <p style="width: 30%">Dịch vụ No.{{index + 1}}: <strong>{{service.name}}</strong></p>
                                <p style="width: 30%">Đơn giá: <strong>{{formatNumber(service.price)}}đ/1 dịch
                                        vụ</strong></p>
                                <p class="">Số lượng đã đặt mua: <strong>{{service.quantity}}</strong></p>
                            </div>
                        </div>
                    </div>
                    <div id="tour-info" class="mb-2">
                        <h6 class="text-uppercase book-trans" style="color: black;">Thông tin về <strong>Tour du
                                lịch</strong> đã đặt</h6>
                        <hr class="p-0 m-0 pb-2">
                        <div class="row">
                            <div class="col-12">
                                <thuan-input v-if="tourData[0]" v-model="tourData[0].title" label="Tên Tour du lịch"
                                    :isRequired="true" :isDisabled="true" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <thuan-input type="date" v-if="tourData[0]" v-model="tourData[0].departure_time"
                                    label="Thời gian khởi hành" :isRequired="true" :isDisabled="true" />
                            </div>
                            <div class="col-6">
                                <thuan-input type="date" v-if="tourData[0]" v-model="tourData[0].arrival_time"
                                    label="Thời gian kết thúc" :isRequired="true" :isDisabled="true" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <thuan-input v-if="tourData[0]" v-model="tourData[0].from_province_name"
                                    label="Địa điểm khởi hành" :isRequired="true" :isDisabled="true" />
                            </div>
                            <div class="col-6">
                                <thuan-input v-if="tourData[0]" v-model="tourData[0].to_province_name"
                                    label="Địa điểm đến" :isRequired="true" :isDisabled="true" />
                            </div>
                        </div>
                    </div>
                    <div id="transportation-info">
                        <h6 class="text-uppercase book-trans" style="color: black;">Thông tin về <strong>phương tiện đã
                                đặt</strong> (Nếu có)</h6>
                        <hr class="p-0 m-0 pb-2">
                        <div class="row">
                            <div class="row">
                                <div class="col-6">
                                    <thuan-input v-if="transportationData[0]" v-model="transportationData[0].id"
                                        label="Mã phương tiện" :isRequired="true" :isDisabled="true" />
                                </div>
                                <div class="col-6">
                                    <thuan-input v-if="transportationData[0]" v-model="transportationData[0].name"
                                        label="Tên phương tiện" :isRequired="true" :isDisabled="true" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <thuan-input type="date" v-if="transportationData[0]"
                                        v-model="transportationData[0].departure_time" label="Thời gian xuất phát"
                                        :isRequired="true" :isDisabled="true" />
                                </div>
                                <div class="col-6">
                                    <thuan-input v-if="transportationData[0]" type="date"
                                        v-model="transportationData[0].arrival_time" label="Thời gian về"
                                        :isRequired="true" :isDisabled="true" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <thuan-input v-model="reservationData.transportation_quantity" label="Số lượng đặt"
                                        :isRequired="true" :isDisabled="true" />
                                </div>
                            </div>
                            <div class="text-center py-3"
                                style="width:90%; background: rgb(242, 242, 242); border-radius: 10px; margin-left: 3.7rem; margin-bottom: 1rem;">
                                <div class="row">
                                    <div class="col-6">
                                        <p>Giá vé phương tiện tại thời điểm đặt:
                                            <strong
                                                style="color: #ff891e;">{{formatNumber(reservationData.transportation_ticket_price
                                                ??
                                                0)}}đ</strong>
                                        </p>
                                    </div>
                                    <div class="col-6">
                                        <p>Giá vé phương tiện bên thứ 3 hiện tại: <strong style="color: #ff891e;"
                                                v-if="transportationData[0]">{{formatNumber(transportationData[0].price)}}đ</strong>
                                        </p>
                                    </div>
                                </div>
                                <!--  -->
                                <div class="row">
                                    <div class="col-12 text-center">
                                        <p>Giá chênh lệch vượt quá ~ ngưỡng chênh lệch đặt ra (Nếu có): <strong
                                                style="color: #ff891e;">{{formatNumber(priceSpread)}}đ</strong>
                                        </p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12 text-center">
                                        <button @click="calAndNotification(reservationData.user_id)"
                                            :disabled="priceSpread == 0" type="button"
                                            class="btn btn-danger bi bi-bell-fill pe-2">&ensp;Tính lại tổng
                                            tiền & Gởi thông báo
                                            cho khách hàng & Xét lại trạng thái đơn hàng</button>
                                    </div>
                                </div>
                            </div>
                            <p class="my-0 py-0"><strong>Chính sách:</strong> Ngưỡng chênh lệch giá đặt phương tiện đặt
                                ra là: 30%
                                trên 1 vé, so với vé tại thời điểm đặt phương tiện hoàn thành lần trước đó.
                            </p>
                            <p class="my-0 py-0" style="font-style: italic; color: blue;">>>>> Ví dụ giá vé đã đặt xe
                                khách tại thời điểm trước khi tour du lịch diễn ra (Tức là đơn hàng
                                chưa ở trạng thái hoàn thành) là 380.000đ đi từ Đà Nẵng vào Vũng Tàu. Nếu giá tăng lên
                                bất thường trong khoảng thời gian này từ
                                494.000đ trở lên thì phải tính toán lại.</p>
                            <p class="my-0 py-0"><strong>1.</strong> Cách tính toán lại: Tổng tiền = Tổng tiền trước đó
                                + Giá
                                chênh
                                lệch phương tiện</p>
                            <p class="my-0 py-0"><strong>2.</strong> Sau đó báo ngay cho khách hàng biết thông qua việc
                                gởi thông báo qua
                                hệ thống, gởi mail cá nhân cho khách hàng hoặc
                                gọi điện, phải nêu
                                rõ lý
                                do và xác nhận xem khách hàng có muốn tiếp tục đặt tour này hay không.</p>
                            <p class="my-0 py-0"><strong>3.</strong> Cuối cùng thiết lập trạng thái đơn hàng về chờ
                                thanh toán. Quay lại quy trình xử lý
                                đơn hàng ban đầu.</p>
                            <p><strong>4.</strong> Quy trình xử lý đơn hàng: Chờ thanh toán => Xác nhận => Đặt phương
                                tiện =>
                                Hoàn thành tour</p>
                        </div>
                    </div>
                    <div id="general-info" class="mb-2">
                        <h6 class="text-uppercase book-trans" style="color: black;">Thông tin chung về <strong>đơn đặt
                                tour</strong> du lịch</h6>
                        <hr class="p-0 m-0 pb-2">
                        <!--  -->
                        <div class="row d-flex justify-content-center p-4 m-3"
                            style="background: rgb(242, 242, 242); border-radius: 10px;">
                            <div class="col-6">
                                <div class="row">
                                    <p>Mã đơn hàng: <strong>{{reservationData.id}}</strong></p>
                                </div>
                                <div class="row">
                                    <p>Thời gian đặt tour: <strong>{{formatDate3(reservationData.created_at)}}</strong>
                                    </p>
                                </div>
                                <div class="row">
                                    <p>Phương tiện di chuyển:
                                        <strong>{{formatDate3(reservationData.type_transportation)}}</strong>
                                    </p>
                                </div>
                                <div class="row">
                                    <p>Ngân hàng thanh toán: <strong
                                            v-if="bankAccountData[0]">{{bankAccountData[0].bank_name}}</strong></p>
                                </div>
                                <div class="row">
                                    <p>Phương thức thanh toán: <strong>{{reservationData.payment_method}}</strong>
                                    </p>
                                </div>
                            </div>
                            <!--  -->
                            <div class="col-6">
                                <div class="row">
                                    <p>Thời gian thanh toán:
                                        <strong>{{formatDate3(reservationData.payment_date)}}</strong>
                                </div>
                                <div class="row">
                                    <p v-if="tourData[0]">Số lượng người lớn:
                                        <strong>{{reservationData.adult_ticket_quantity}} x
                                            {{tourData[0].adult_ticket_price}}</strong>
                                    </p>
                                </div>
                                <div class="row">
                                    <p v-if="tourData[0]">Số lượng trẻ em:
                                        <strong>{{reservationData.child_ticket_quantity}} x
                                            {{tourData[0].child_ticket_price}}</strong>
                                    </p>
                                </div>
                                <div class="row">
                                    <p v-if="tourData[0]">Số lượng em bé:
                                        <strong>{{reservationData.infant_ticket_quantity}} x
                                            {{tourData[0].infant_ticket_price}}</strong>
                                    </p>
                                </div>
                                <div class="row">
                                    <p v-if="tourData[0]">Số tiền đã thanh toán:
                                        <strong>{{formatNumber(reservationData.payment_amount)}}</strong>
                                    </p>
                                </div>
                            </div>
                            <div class="row d-flex justify-content-center m-0 p-0">
                                <h5 style="color: black; font-weight: 500;" v-if="tourData[0]" class="text-center m-0">
                                    Tổng
                                    hoá
                                    đơn:
                                    <strong
                                        style="color: #ff891e;">{{formatNumber(reservationData.total_amount)}}</strong>
                                </h5>
                            </div>
                        </div>
                        <!--  -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <thuan-select label="Trạng thái" :options="selectOptions.statusOrder"
                                    v-model="data.status" :isRequired="true" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-close-modal-detail" type="button" class="btn btn-secondary"
                        data-bs-dismiss="modal">Đóng</button>
                    <button @click="saveStatusOrder" type="button" class="btn btn-primary">Lưu thông tin</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal confirm -->
    <div class="modal fade" id="orderConfirmModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-uppercase" id="exampleModalLabel">Xác nhận thông tin tour du lịch</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        Xác nhận thông tin tour du lịch ở đây
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-close-modal" type="button" class="btn btn-secondary"
                        data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary" @click="onSave">Lưu thông tin</button>
                </div>
            </div>
        </div>
    </div>
    <!-- modal transportation -->
    <div class="modal fade" id="orderTransportationModal" tabindex="-1" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-uppercase" id="exampleModalLabel">Đặt phương tiện di chuyển - 2 chiều
                        bao gồm cả đi & về</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <h6 style="line-height: 1.5;" class="text-uppercase book-trans text-center">DANH SÁCH PHƯƠNG
                            TIỆN LIÊN KẾT VỚI BÊN THỨ 3
                            CÓ NGÀY KHỞI HÀNH
                            <strong>{{formatDate(bookTransCondition.departure_time)}}</strong>
                            - LOẠI PHƯƠNG
                            TIỆN <strong>{{bookTransCondition.type_transportation_name}}</strong> -
                            số lượng chỗ cần đặt là <strong>{{bookTransCondition.quantity}}</strong> - Nơi khởi hành
                            <strong>{{bookTransCondition.from_location}}</strong> - Nơi đến
                            <strong>{{bookTransCondition.to_location}}</strong>
                        </h6>
                        <p class="text-center" style="font-style: italic;">(Đối tượng là trẻ em dưới 2 tuổi, được miễn
                            phí khi đặt phương tiện nên
                            không được tính vào
                            số lượng cần đặt ở trên)</p>
                    </div>
                    <!-- table -->
                    <div class="row">
                        <table style="font-size: 80%;" class="table table-striped mt-1">
                            <thead>
                                <tr>
                                    <th class="align-middle text-center" style="width: 3%;" scope="col">STT</th>
                                    <th class="align-middle" scope="col">Tên phương tiện</th>
                                    <th class="align-middle" scope="col" style="width: 15%;">Thời gian khởi hành</th>
                                    <th class="align-middle" scope="col" style="width: 15%;">Địa điểm khởi hành</th>
                                    <th class="align-middle" scope="col" style="width: 9%;">Nơi đến</th>
                                    <th class="align-middle" scope="col" style="width: 10%;">SL hiện tại</th>
                                    <th class="align-middle" scope="col" style="width: 10%;">SL Giới hạn</th>
                                    <th class="align-middle" scope="col" style="width: 10%;">Giá vé</th>
                                    <th class="align-middle" scope="col" style="width: 10%;">Đặt chỗ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(trans, index) in bookTransData" :key="index">
                                    <th class="align-middle text-center" scope="row">{{index+1}}</th>
                                    <td class="align-middle" style="font-size: 95%;">{{trans.name}}</td>
                                    <td class="align-middle">{{formatDate(trans.departure_time)}}</td>
                                    <td class="align-middle">{{trans.from_location}}</td>
                                    <td class="align-middle">{{trans.to_location}}</td>
                                    <td class="align-middle">{{trans.quantity}}</td>
                                    <td class="align-middle">{{trans.maximum_quantity}}</td>
                                    <td class="align-middle">{{formatNumber(trans.price)}} đ</td>
                                    <td class="align-middle">
                                        <button data-bs-toggle="modal" data-bs-target="#orderTransportationModal"
                                            type="button" @click="bookingTrans(trans.price, trans.id)"
                                            class="btn btn-success btn-sm bi bi-bag-heart-fill me-2"></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-close-modal-book-trans" type="button" class="btn btn-secondary"
                        data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>
</div>